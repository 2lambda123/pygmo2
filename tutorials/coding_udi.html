

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Coding a User Defined Island &mdash; pygmo 2.16.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/logo_favico.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A first tutorial on the use of NLopt solvers" href="nlopt_basics.html" />
    <link rel="prev" title="Using the decorator meta-problem" href="udp_meta_decorator.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pygmo
          

          
          </a>

          
            
            
              <div class="version">
                2.16.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Capabilities</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#coding-your-own-problem-udp">Coding your own problem (UDP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#meta-problems">Meta-problems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="tutorials.html#coding-your-own-island-udi">Coding your own island (UDI)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Coding a User Defined Island</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#local-optimization">Local optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#multi-objective-optimization">Multi-objective optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#hypervolumes">Hypervolumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#advanced-examples">Advanced Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known_issues.html">Known issues</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pygmo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Coding a User Defined Island</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/coding_udi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="coding-a-user-defined-island">
<span id="py-tutorial-coding-udi-simple"></span><h1>Coding a User Defined Island<a class="headerlink" href="#coding-a-user-defined-island" title="Permalink to this headline">Â¶</a></h1>
<p>While pagmo provides a number of UDIs (see <a class="reference internal" href="../islands.html#islands"><span class="std std-ref">List of islands</span></a>) to provide access to a number of parallelization technologies, the expert user
can code his own expanding pygmo functionalities. In this tutorial we will show how to code a UDI. Remember that UDIs are classes that can be used
to construct a <a class="reference internal" href="../island.html#pygmo.island" title="pygmo.island"><code class="xref py py-class docutils literal notranslate"><span class="pre">island</span></code></a> which, in turn, is what a <a class="reference internal" href="../archipelago.html#pygmo.archipelago" title="pygmo.archipelago"><code class="xref py py-class docutils literal notranslate"><span class="pre">archipelago</span></code></a> can use to distribute / parallelize optimization
tasks and have solutions migrate improving the overall optimization quality via the generalized island model.</p>
<p>We encourage the user to read the documentation of the class <a class="reference internal" href="../island.html#pygmo.island" title="pygmo.island"><code class="xref py py-class docutils literal notranslate"><span class="pre">island</span></code></a> to have a detailed list of methods that can be, or have to be,
implemented in a UDI. Also the tutorial <a class="reference internal" href="using_island.html#py-tutorial-using-island"><span class="std std-ref">Use of the class island</span></a> is a good starting point to understand the overall use.</p>
<p>A UDI is a python class which, in its simplest form, contains the method <code class="docutils literal notranslate"><span class="pre">run_evolve(self,</span> <span class="pre">algo,</span> <span class="pre">pop)</span></code> which uses the <a class="reference internal" href="../algorithm.html#pygmo.algorithm" title="pygmo.algorithm"><code class="xref py py-class docutils literal notranslate"><span class="pre">algorithm</span></code></a> <code class="docutils literal notranslate"><span class="pre">algo</span></code> to evolve
the <a class="reference internal" href="../population.html#pygmo.population" title="pygmo.population"><code class="xref py py-class docutils literal notranslate"><span class="pre">population</span></code></a> <code class="docutils literal notranslate"><span class="pre">pop</span></code>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pygmo</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_isl</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run_evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algo</span><span class="p">,</span> <span class="n">pop</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">new_pop</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">algo</span><span class="p">,</span> <span class="n">new_pop</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s2">&quot;It&#39;s my island!&quot;</span>
</pre></div>
</div>
<p>We have also included above the optional method <code class="docutils literal notranslate"><span class="pre">get_name(self)</span></code> that will be used by various <code class="docutils literal notranslate"><span class="pre">__repr__(self)</span></code> to provide humar readable information
on some pygmo classes. The above UDI can then be used to construct a <a class="reference internal" href="../island.html#pygmo.island" title="pygmo.island"><code class="xref py py-class docutils literal notranslate"><span class="pre">island</span></code></a> (similarly to how UDP can be used to construct <a class="reference internal" href="../problem.html#pygmo.problem" title="pygmo.problem"><code class="xref py py-class docutils literal notranslate"><span class="pre">problem</span></code></a>, etc..).</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">isl</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">island</span><span class="p">(</span><span class="n">algo</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">de</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ackley</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">udi</span> <span class="o">=</span> <span class="n">my_isl</span><span class="p">(),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> 
<span class="go">Island name: It&#39;s my island!</span>
<span class="go">    C++ class name: ...</span>

<span class="go">    Status: idle</span>

<span class="go">Algorithm: DE: Differential Evolution</span>

<span class="go">Problem: Ackley Function</span>

<span class="go">Replacement policy: Fair replace</span>

<span class="go">Selection policy: Select best</span>

<span class="go">Population size: 20</span>
<span class="go">    Champion decision vector: [...</span>
<span class="go">    Champion fitness: [...</span>
</pre></div>
</div>
<p>That was easy! Lets now understand what we actually did. The object <code class="docutils literal notranslate"><span class="pre">isl</span></code> now contains our UDI and, upon construction will open a thread and delegate the execution of
<code class="docutils literal notranslate"><span class="pre">run_evolve(self,</span> <span class="pre">algo,</span> <span class="pre">pop)</span></code> to it upon call to <a class="reference internal" href="../island.html#pygmo.island.evolve" title="pygmo.island.evolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">evolve()</span></code></a>. The <code class="docutils literal notranslate"><span class="pre">run_evolve()</span></code> method must return the algorithm object used for
the evolution and the evolved population.</p>
<p>But there is a catch. We are in CPython! CPython, generally speaking, serialises the execution of Python code due to the presence
of the global interpreter lock (GIL). So, while the code above is perfectly fine and will
work with pygmo, a set of <code class="docutils literal notranslate"><span class="pre">my_isl</span></code> running evolutions will not run in parallel as each <a class="reference internal" href="../island.html#pygmo.island" title="pygmo.island"><code class="xref py py-class docutils literal notranslate"><span class="pre">island</span></code></a>, when executing its <a class="reference internal" href="../island.html#pygmo.island.evolve" title="pygmo.island.evolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">evolve()</span></code></a>
method, acquires the GIL and holds it during the <a class="reference internal" href="../island.html#pygmo.island.evolve" title="pygmo.island.evolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">evolve()</span></code></a> execution.</p>
<p>As a consequence, the following code:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archi</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">archipelago</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">algo</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">de</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">rosenbrock</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">pop_size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">udi</span> <span class="o">=</span> <span class="n">my_isl</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archi</span><span class="o">.</span><span class="n">evolve</span><span class="p">()</span>
</pre></div>
</div>
<p>will not run evolution in parallel (only using different threads).</p>
<p>To code properly an UDI one need to code the <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">run_evolve(self,</span> <span class="pre">algo,</span> <span class="pre">pop)</span></code> so that the GIL is released during the offload of the evolution task to a separate process.
An example on how this can be achieved using, for example the multiprocessing module of python. Let us have a look at some code snippets from the  <a class="reference internal" href="../islands.html#pygmo.mp_island" title="pygmo.mp_island"><code class="xref py py-class docutils literal notranslate"><span class="pre">mp_island</span></code></a></p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_evolve_func</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">pop</span><span class="p">):</span> <span class="c1"># doctest : +SKIP</span>
<span class="gp">... </span>    <span class="n">new_pop</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">algo</span><span class="p">,</span> <span class="n">new_pop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mp_island</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="c1"># doctest : +SKIP</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Init the process pool, if necessary.</span>
<span class="gp">... </span>        <span class="n">mp_island</span><span class="o">.</span><span class="n">init_pool</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run_evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algo</span><span class="p">,</span> <span class="n">pop</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">with</span> <span class="n">mp_island</span><span class="o">.</span><span class="n">_pool_lock</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">res</span> <span class="o">=</span> <span class="n">mp_island</span><span class="o">.</span><span class="n">_pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">_evolve_func</span><span class="p">,</span> <span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">pop</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>The full details are here not reported and can be read in the <a class="reference internal" href="../islands.html#pygmo.mp_island" title="pygmo.mp_island"><code class="xref py py-class docutils literal notranslate"><span class="pre">mp_island</span></code></a> code. In a nutshell, what happens is that the <code class="docutils literal notranslate"><span class="pre">algo.evolve(pop)</span></code> gets offloaded to
a process (in a shared pool inited upon construction calling the <a class="reference internal" href="../islands.html#pygmo.mp_island.init_pool" title="pygmo.mp_island.init_pool"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_pool()</span></code></a> static method). The instruction <code class="docutils literal notranslate"><span class="pre">res.get()</span></code>, makes the thread where <code class="docutils literal notranslate"><span class="pre">run_evolve</span></code>
remain waiting for the process execution and while doing so it releases the GIL, making parallelization effective.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nlopt_basics.html" class="btn btn-neutral float-right" title="A first tutorial on the use of NLopt solvers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="udp_meta_decorator.html" class="btn btn-neutral float-left" title="Using the decorator meta-problem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, pagmo development team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>